# 系统通知功能测试指南

## 编译状态
✅ 编译成功，无错误

## 快速测试步骤

### 1. 编译并运行应用
```bash
npm run tauri dev
# 或者构建发布版本
npm run tauri build
```

### 2. 测试通知权限

#### 方法1：使用测试按钮（推荐）
1. 打开应用
2. 点击设置按钮（齿轮图标）
3. 进入"使用设置"标签
4. 找到"倒计时提醒"部分
5. 开启"启用倒计时通知"开关
6. 点击"发送测试通知"按钮
7. 应该立即看到系统通知

**如果没有看到通知：**
- 检查 Windows 通知设置
- 打开"设置" > "系统" > "通知"
- 找到 DeskHive 并确保通知已开启

### 3. 测试实际任务通知

#### 快速测试（1分钟内）
1. 在设置中将"提前提醒时间"设为 **1 分钟**
2. 保存设置
3. 返回主界面
4. 创建一个新任务
5. 右键任务 > 设置截止时间
6. 设置截止时间为：**当前时间 + 1分钟**
   - 例如：现在是 14:30，设置为 14:31
7. 等待最多 1 分钟
8. 应该收到通知

#### 标准测试（30分钟）
1. 在设置中将"提前提醒时间"设为 **30 分钟**（默认值）
2. 保存设置
3. 创建一个新任务
4. 设置截止时间为：**当前时间 + 30分钟**
   - 例如：现在是 14:00，设置为 14:30
5. 等待约 30 分钟
6. 应该收到通知

## 通知内容示例

```
标题：DeskHive 任务提醒
内容：任务即将到期 (14:30)
     完成项目报告
```

## 常见问题排查

### Q1: 点击"发送测试通知"没反应
**解决方案：**
1. 检查 Windows 通知权限
2. 打开"设置" > "系统" > "通知"
3. 确保"通知"总开关已开启
4. 找到 DeskHive 应用并开启通知

### Q2: 测试通知成功，但任务通知不工作
**检查清单：**
- [ ] "启用倒计时通知"开关已开启
- [ ] 任务有设置截止时间
- [ ] 任务未完成
- [ ] 距离截止时间等于设置的提前时间
- [ ] 等待时间足够（最多1分钟延迟）

### Q3: 收到重复通知
**说明：**
- 正常情况下每个任务只会通知一次
- 如果重启应用，可能会重新发送一次
- 这是正常行为

### Q4: 通知有延迟
**说明：**
- 通知检查间隔为 60 秒
- 可能有最多 1 分钟的延迟
- 这是为了节省系统资源的设计

## 技术细节

### 通知触发条件
```
当前时间 >= 截止时间 - 提前时间 - 30秒
且
当前时间 <= 截止时间 - 提前时间 + 30秒
```

### 时间窗口示例
- 截止时间：14:30:00
- 提前时间：30分钟
- 通知时间窗口：13:59:30 ~ 14:00:30
- 检查间隔：每60秒一次

### 通知去重
- 使用任务ID进行去重
- 每个任务只通知一次
- 任务超期1小时后清理记录
- 应用重启后重置记录

## 调试信息

### 查看日志
在开发模式下，通知相关的日志会输出到控制台：
```
已发送通知: [任务文本]
加载设置失败: [错误信息]
加载待办事项数据失败: [错误信息]
```

### 手动触发检查
通知检查每60秒自动执行一次，无需手动触发。

## 下一步

如果所有测试都通过，你可以：
1. 正常使用应用
2. 为重要任务设置截止时间
3. 在任务到期前收到提醒
4. 根据需要调整提前提醒时间（1-1440分钟）

## 反馈

如果遇到问题，请检查：
1. Windows 版本（需要 Windows 10 或更高）
2. 系统通知权限
3. 应用日志输出
4. 任务设置是否正确
